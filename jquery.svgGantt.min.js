(function(d,b,a,f){var c="svgGantt",e={gridColor:"#DDD",objectScale:2,currentDate:null,offsetY:0,view:"month",views:{week:{gridX:150,gridY:12,format:"MMM, DD",labelEvery:"day"},month:{gridX:42,gridY:12,format:"MMM, DD",labelEvery:"day"},year:{gridX:13,gridY:12,format:"MMM",labelEvery:"month"}}};function g(j,l,h){var k=this;k.container=d(j);k.options=d.extend({},e,h);k.objects=l;k.init()}g.prototype={init:function(){var h=this;h.createUI();h.createEvents();h.drawGrid();h.setTimePosition();h.drawLabels();h.dragInit();h.createElements();h.arrangeElements()},createUI:function(){var j=this,h=j.options,k=j.container;k.html("").css({overflow:"hidden"});d('<div class="sg-labels"></div>').appendTo(k);j.labels=k.find(".sg-labels");d('<div class="sg-content"></div>').appendTo(k);j.content=k.find(".sg-content");d('<canvas class="sg-grid"></canvas>').appendTo(k).hide();j.grid=k.find(".sg-grid")},createEvents:function(){var j=this,h=j.options,k=j.container;k.off("gantt-changeView").on("gantt-changeView",function(m,l){h.view=l;j.init()})},drawGrid:function(){var n=this,m=this.options,l=n.grid[0],k=l.getContext("2d"),j=m.views[m.view],h=j.gridX,o=j.gridY;l.height=o;l.width=h;k.moveTo(h-0.5,-0.5);k.lineTo(h-0.5,o-0.5);k.lineTo(-0.5,o-0.5);k.strokeStyle=m.gridColor;k.stroke();data=l.toDataURL("image/jpg");n.content.css({background:"url("+data+")"})},setTimePosition:function(){var k=this,r=k.options,o=r.views[r.view],q=k.container,p=q.width(),m=p*3,l=o.gridX,j=-(Math.floor(p/l)*l),h=r.currentDate,n=h?moment(h):moment();k.startMoment=n.subtract("days",Math.floor(p/l));k.daysInGrid=m/l;k.content.css({height:q.height()*3,marginLeft:j,position:"relative",marginTop:r.offsetY,width:m});k.labels.css({left:j,width:m})},drawLabels:function(){var k=this,r=k.options,o=r.views[r.view],q=k.daysInGrid,l=o.gridX;for(var j=0;j<q;j++){var n=moment(k.startMoment).add("days",j),h=false;if(o.labelEvery==="month"){if(n.format("D")==="1"){h=true}}else{h=true}if(h){var p=n.format(o.format),m=d('<div class="sg-label"><div class="sg-'+r.view+'">'+p+"</div></div>");k.labels.append(m);m.css({left:l*j,position:"absolute",textAlign:"center",top:5,width:l})}}},dragInit:function(){var m=this,l=m.options,k=container={x:0,y:0},n=false,h=l.views[l.view].gridX,j=m.content,o=curMoment=null;j.off().on("mousedown mousemove mouseup",function(p){if(p.type==="mousedown"){n=true;k={x:p.pageX,y:p.pageY};container={x:parseInt(j.css("margin-left")),y:parseInt(j.css("margin-top"))};curDayOffset=Math.round(parseInt(j.css("margin-left"))/h);o=moment(m.startMoment).subtract("days",curDayOffset)}else{if(p.type==="mousemove"&&n){marginLeft=container.x+(p.pageX-k.x);marginTop=container.y+(p.pageY-k.y);if(marginLeft>0){marginLeft=0}if(marginTop>0){marginTop=0}j.css({marginLeft:marginLeft,marginTop:marginTop});m.labels.css({left:marginLeft})}else{if(p.type==="mouseup"){n=false;curDayOffset=Math.round(parseInt(j.css("margin-left"))/h);curMoment=moment(m.startMoment).subtract("days",curDayOffset);if(curMoment.format("MM DD")!=o.format("MM DD")){l.currentDate=curMoment;l.offsetY=parseInt(j.css("margin-top"));m.init()}}}}})},createElements:function(){var p=this,v=p.options,r=v.views[v.view],q=r.gridX;for(i=0;i<p.objects.length;i++){var n=p.objects[i],t=d('<div class="sg-object"></div>'),j=d('<img class="sg-icon" src="'+n.iconURL+'" />').appendTo(t),u=d('<div class="sg-name">'+n.name+"</div>").appendTo(t),l=moment(n.startDate),o=moment(n.endDate),h=o.diff(l,"days")+1,m=l.diff(p.startMoment,"days"),s=r.gridY*v.objectScale,k=h*q;p.content.append(t);j.css({height:s,width:s});u.css({width:k-j.outerWidth(true)});t.css({background:n.color,height:s,left:m*q,top:-30,width:k})}},arrangeElements:function(y){var C=this,n=C.options,p=C.content.children(),v=n.views[n.view].gridY,z=v*n.objectScale,h=C.objects;for(var w=0;w<h.length;w++){var r=C.objects[w],k=moment(r.startDate).unix(),u=moment(r.endDate).unix(),B=d(p[w]),o=0;for(var t=0;t<w;t++){var D=h[t],l=moment(D.startDate).unix(),m=moment(D.endDate).unix(),A=C.isBetween(l,k,m),x=C.isBetween(l,u,m),s=C.isBetween(k,l,u),q=C.isBetween(k,m,u);if(A||x||s||q){o++}}attributes={top:v+(o*(z+v))};if(y){B.animate(attributes)}else{B.css(attributes)}}},isBetween:function(k,h,j){return(k<j?h>=k&&h<=j:h>=j&&h<=k)}};d.fn[c]=function(j,h){return this.each(function(){if(!d.data(this,"plugin_"+c)){d.data(this,"plugin_"+c,new g(this,j,h))}})}})(jQuery,window,document);