(function(d,b,a,f){var c="svgGantt",e={currentDate:null,grid:{color:"#DDD",offsetY:0},mode:"regular",modes:{regular:{scale:2,paddingY:1,showContent:true},collapsed:{scale:1,paddingY:0,showContent:false}},view:"month",views:{week:{gridX:150,gridY:12,format:"MMM, DD",labelEvery:"day"},month:{gridX:42,gridY:12,format:"MMM, DD",labelEvery:"day"},year:{gridX:13,gridY:12,format:"MMM",labelEvery:"month"}}};function g(j,l,h){var k=this;k.container=d(j);k.options=d.extend({},e,h);k.objects=l;k.init()}g.prototype={init:function(){var j=this,h=j.options;j.createUI();j.createEvents();j.drawGrid();j.setTimePosition();j.drawLabels();j.dragInit();j.createElements();j.arrangeElements()},createUI:function(){var j=this,h=j.options,k=j.container;k.html("").css({overflow:"hidden"});d('<div class="sg-labels"></div>').appendTo(k);j.labels=k.find(".sg-labels");d('<div class="sg-content"></div>').appendTo(k);j.content=k.find(".sg-content");d('<canvas class="sg-grid"></canvas>').appendTo(k).hide();j.grid=k.find(".sg-grid")},createEvents:function(){var j=this,h=j.options,k=j.container;k.off("gantt-changeView").on("gantt-changeView",function(m,l){h.view=l;j.init()});k.off("gantt-collapse").on("gantt-collapse",function(){if(h.mode==="collapsed"){h.mode="regular"}else{h.mode="collapsed"}j.init()})},drawGrid:function(){var n=this,m=this.options,l=n.grid[0],k=l.getContext("2d"),j=m.views[m.view],h=j.gridX,o=j.gridY;l.height=o;l.width=h;k.moveTo(h-0.5,-0.5);k.lineTo(h-0.5,o-0.5);k.lineTo(-0.5,o-0.5);k.strokeStyle=m.grid.color;k.stroke();data=l.toDataURL("image/jpg");n.content.css({background:"url("+data+")"})},setTimePosition:function(){var k=this,r=k.options,o=r.views[r.view],q=k.container,p=q.width(),m=p*3,l=o.gridX,j=-(Math.floor(p/l)*l),h=r.currentDate,n=h?moment(h):moment();k.startMoment=n.subtract("days",Math.floor(p/l));k.daysInGrid=m/l;k.content.css({height:q.height()*3,marginLeft:j,position:"relative",marginTop:r.grid.offsetY,width:m});k.labels.css({left:j,width:m})},drawLabels:function(){var k=this,r=k.options,o=r.views[r.view],q=k.daysInGrid,l=o.gridX;for(var j=0;j<q;j++){var n=moment(k.startMoment).add("days",j),h=false;if(o.labelEvery==="month"){if(n.format("D")==="1"){h=true}}else{h=true}if(h){var p=n.format(o.format),m=d('<div class="sg-label"><div class="sg-'+r.view+'">'+p+"</div></div>");k.labels.append(m);m.css({left:l*j,position:"absolute",textAlign:"center",top:5,width:l})}}},dragInit:function(){var m=this,l=m.options,k=container={x:0,y:0},n=false,h=l.views[l.view].gridX,j=m.content,o=curMoment=null;j.off().on("mousedown mousemove mouseup",function(p){if(p.type==="mousedown"){n=true;k={x:p.pageX,y:p.pageY};container={x:parseInt(j.css("margin-left")),y:parseInt(j.css("margin-top"))};curDayOffset=Math.round(parseInt(j.css("margin-left"))/h);o=moment(m.startMoment).subtract("days",curDayOffset)}else{if(p.type==="mousemove"&&n){marginLeft=container.x+(p.pageX-k.x);marginTop=container.y+(p.pageY-k.y);if(marginLeft>0){marginLeft=0}if(marginTop>0){marginTop=0}j.css({marginLeft:marginLeft,marginTop:marginTop});m.labels.css({left:marginLeft})}else{if(p.type==="mouseup"){n=false;curDayOffset=Math.round(parseInt(j.css("margin-left"))/h);curMoment=moment(m.startMoment).subtract("days",curDayOffset);if(curMoment.format("MM DD")!=o.format("MM DD")){l.currentDate=curMoment;l.grid.offsetY=parseInt(j.css("margin-top"));m.init()}}}}})},createElements:function(){var r=this,x=r.options,t=x.views[x.view],s=t.gridX,q=x.modes[x.mode];for(i=0;i<r.objects.length;i++){var o=r.objects[i],v=d('<div class="sg-object"></div>'),j=d('<img class="sg-icon" src="'+o.iconURL+'" />'),w=d('<div class="sg-name">'+o.name+"</div>"),l=moment(o.startDate),p=moment(o.endDate),h=p.diff(l,"days")+1,n=l.diff(r.startMoment,"days"),u=t.gridY*q.scale,k=h*s,m=n*s;if(q.showContent){v.append(j).append(w)}r.content.append(v);j.css({height:u,width:u});w.css({width:k-j.outerWidth(true)});v.css({background:o.color,height:u,left:m,top:-30,width:k})}},arrangeElements:function(A){var E=this,n=E.options,p=n.modes[n.mode],q=E.content.children(),x=n.views[n.view].gridY,v=x*p.paddingY,B=x*p.scale,h=E.objects;for(var y=0;y<h.length;y++){var s=E.objects[y],k=moment(s.startDate).unix(),w=moment(s.endDate).unix(),D=d(q[y]),o=0;for(var u=0;u<y;u++){var F=h[u],l=moment(F.startDate).unix(),m=moment(F.endDate).unix(),C=E.isBetween(l,k,m),z=E.isBetween(l,w,m),t=E.isBetween(k,l,w),r=E.isBetween(k,m,w);if(C||z||t||r){o++}}attributes={top:v+(o*(B+v))};if(A){D.animate(attributes)}else{D.css(attributes)}}},isBetween:function(k,h,j){return(k<j?h>=k&&h<=j:h>=j&&h<=k)}};d.fn[c]=function(j,h){return this.each(function(){if(!d.data(this,"plugin_"+c)){d.data(this,"plugin_"+c,new g(this,j,h))}})}})(jQuery,window,document);